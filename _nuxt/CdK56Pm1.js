import{_ as G}from"./DoweZdBC.js";import{_ as J}from"./BkaXcX0r.js";import{_ as K,u as Q}from"./s9-G_ldQ.js";import{p as T,m as X}from"./KQyl5nPc.js";import{f as Y}from"./B1uqA_Xj.js";import{e as R,p as V,g as f,u as Z,r as U,o as i,c as l,a as s,j as x,k as d,s as C,i as t,b as u,v as N,F as L,x as ss,h as ts,n as es,w as v,l as D,t as k}from"./Z1nLE7KB.js";import{_ as S}from"./DlAUqK2U.js";import{u as os,c as ns}from"./DEfN9ERZ.js";import{u as is}from"./CT_kBzEL.js";import"./DGMa4gKQ.js";const as={class:"profile"},rs={class:"container"},ls={class:"nav"},cs={key:0},_s={key:0},us={class:"profile_content"},ms=R({__name:"Profile",props:{isLoading:{type:Boolean}},setup(P){const{$viewport:c}=V(),_=f(()=>c.matches("mobile_small","mobile"));Z({title:()=>"Profile"});const e=U("favorites");return(m,o)=>{const y=K;return i(),l(L,null,[s("div",as,[s("div",rs,[m.isLoading?(i(),x(y,{key:0})):d("",!0),o[4]||(o[4]=s("h2",null,"Мой аккаунт",-1)),s("div",ls,[s("button",{class:C(["nav-link",{active_border:t(e)==="favorites"}]),id:"favorites",onClick:o[0]||(o[0]=$=>e.value="favorites")},[u(t(Y)),o[2]||(o[2]=s("span",null,"Избранные",-1)),t(_)?d("",!0):(i(),l("span",cs,"фильмы"))],2),s("button",{class:C(["nav-link",{active_border:t(e)==="settings"}]),id:"settings",onClick:o[1]||(o[1]=$=>e.value="settings")},[u(t(T)),o[3]||(o[3]=s("span",null,"Настройка",-1)),t(_)?d("",!0):(i(),l("span",_s,"аккаунта"))],2)])])]),s("div",us,[s("div",{class:C(["container",{container_active:t(e)==="favorites"}])},[t(e)==="favorites"?N(m.$slots,"favorites",{key:0},void 0):d("",!0),t(e)==="settings"?N(m.$slots,"settings",{key:1},void 0):d("",!0)],2)])],64)}}}),ps=S(ms,[["__scopeId","data-v-81723b90"]]),ds=["src"],vs={key:1,class:"movie_list"},fs=["src"],gs=["onClick"],hs={class:"wrapper"},ks={class:"user_info"},ys={class:"user_info-item"},$s={class:"user_info-icon"},ws={class:"user_info-value"},bs={class:"user_info-item"},Cs={class:"user_info-icon"},xs={class:"user_info-value"},Ls=R({__name:"ProfileData",async setup(P){let c,_;const e=os(),m=ss(),o=U(null),{$viewport:y}=V(),$=f(()=>y.matches("mobile_small")),{start:j,finish:z}=ts(),{data:A,refresh:E,status:H}=([c,_]=es(async()=>Q("userAndMovies",async()=>{j();try{const a=is();await e.profile();const n=e.user;if(n!=null&&n.favorites&&n.favorites.length>0){const g=n.favorites.map(async h=>(await a.fetchMovieId(h),{id:h,poster:a.movie.posterUrl})),w=await Promise.all(g);return{user:n,movies:w}}return{user:n,movies:[]}}finally{z()}})),c=await c,_(),c),p=f(()=>{var a;return(a=A.value)==null?void 0:a.user}),I=f(()=>{var a;return((a=A.value)==null?void 0:a.movies)||[]}),O=f(()=>H.value==="pending"),W=async a=>{await e.removeFavorites(a),await E()},q=async()=>{await e.logout(),m.push("/")};return(a,n)=>{const g=G,w=J,h=ps;return i(),x(h,{isLoading:t(O)},{favorites:v(()=>[t($)?(i(),x(w,{key:0},{default:v(()=>[s("swiper-container",{class:"movie_list",ref_key:"containerRef",ref:o,loop:!0,"slides-per-view":"auto","space-between":40,"slides-offset-before":20},[(i(!0),l(L,null,D(t(I),r=>(i(),l("swiper-slide",{class:"movie_item",key:r.id,style:{width:"224px"}},[u(g,{class:"movie_link",to:`/movies/${r.id}`},{default:v(()=>[s("img",{src:r.poster,alt:"Movie Poster"},null,8,ds)]),_:2},1032,["to"])]))),128))],512)]),_:1})):(i(),l("ul",vs,[(i(!0),l(L,null,D(t(I),r=>(i(),l("li",{class:"movie_item",key:r.id},[u(g,{class:"movie_link",to:`/movies/${r.id}`},{default:v(()=>[s("img",{src:r.poster,alt:"Movie Poster"},null,8,fs)]),_:2},1032,["to"]),s("button",{class:"movie_remove",onClick:b=>W(r.id)},[u(t(ns))],8,gs)]))),128))]))]),settings:v(()=>{var r,b,B,F,M;return[s("div",hs,[s("ul",ks,[s("li",ys,[s("span",$s,k(`${(r=t(p))==null?void 0:r.name[0].charAt(0).toUpperCase()}${(b=t(p))==null?void 0:b.surname[0].charAt(0).toUpperCase()}`),1),n[0]||(n[0]=s("span",{class:"user_info-title"},"Имя Фамилия",-1)),s("span",ws,k((B=t(p))==null?void 0:B.name)+" "+k((F=t(p))==null?void 0:F.surname),1)]),s("li",bs,[s("span",Cs,[u(t(X))]),n[1]||(n[1]=s("span",{class:"user_info-title"},"Электронная почта",-1)),s("span",xs,k((M=t(p))==null?void 0:M.email),1)])]),s("button",{class:"logout-button",onClick:q}," Выйти из аккаунта ")])]}),_:1},8,["isLoading"])}}}),Ss=S(Ls,[["__scopeId","data-v-a66bc141"]]),Ps={};function As(P,c){const _=Ss;return i(),l("div",null,[u(_)])}const zs=S(Ps,[["render",As],["__scopeId","data-v-92e3c052"]]);export{zs as default};
